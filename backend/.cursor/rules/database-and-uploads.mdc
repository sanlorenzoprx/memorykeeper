---
description: Best practices for interacting with the D1 database and handling R2 uploads.
type: Agent Requested
---

# Backend: Database and Storage Patterns

## D1 Database Interaction
- **Access**: Always access the D1 database via the context binding: `c.env.DB`.
- **Queries**: **Always** use prepared statements (`.prepare()`) and bind parameters (`.bind()`) to prevent SQL injection.
- **Schema**: Remember that all table and column names must be `snake_case`. Refer to the schema file for the source of truth.

```typescript
// Correct way to query D1
const { results } = await c.env.DB.prepare(
  'SELECT id, r2_key FROM photos WHERE owner_id = ?'
).bind(userId).all();